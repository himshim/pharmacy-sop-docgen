<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        /* Auto-numbering for toggleable sections */
        body { counter-reset: section; }
        h2:not(.no-counter) { counter-increment: section; }
        h2:not(.no-counter)::before { content: counter(section) ". "; }

        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        table, th, td { border: 1px solid #666; }
        th, td { padding: 8px; text-align: left; }
        th { background-color: #e0e0e0; font-weight: bold; }
        h1 { text-align: center; font-size: 20px; margin: 10px 0; }
        h2 { font-size: 16px; margin: 15px 0 8px 0; }
        p, ul, ol { margin: 8px 0; line-height: 1.6; }
        .header-table td { padding: 6px; }
        .signature-table td { text-align: center; vertical-align: top; }
    </style>
</head>
<body>
    <h1>{{title}}</h1>

    <!-- Document Control Header -->
    {{#if sectionDocControl}}
    <table class="header-table">
        <tr>
            <td><b>Institute:</b> {{institute}}</td>
            <td><b>Department:</b> {{department}}</td>
        </tr>
        <tr>
            {{#if sectionSopNumber}}<td><b>SOP Number:</b> {{sopNumber}}</td>{{/if}}
            <td><b>Revision No:</b> {{revisionNo}}</td>
        </tr>
        <tr>
            {{#if sectionEffectiveDate}}<td><b>Effective Date:</b> {{effectiveDate}}</td>{{/if}}
            {{#if sectionRevisionDate}}<td><b>Revision Date:</b> {{revisionDate}}</td>{{/if}}
        </tr>
        <tr>
            <td><b>Next Review Date:</b> {{nextReviewDate}}</td>
            {{#if sectionCopyType}}<td><b>Copy Type:</b> {{copyType}}</td>{{/if}}
        </tr>
    </table>
    {{/if}}

    <!-- Purpose -->
    <h2>Purpose</h2>
    {{{purpose}}}

    <!-- Scope -->
    <h2>Scope</h2>
    {{{scope}}}

    <!-- Applicability (Toggleable) -->
    {{#if sectionApplicability}}
    <h2>Applicability</h2>
    {{{applicability}}}
    {{/if}}

    <!-- Responsibility -->
    <h2>Responsibility</h2>
    {{{responsibility}}}

    <!-- Abbreviations (Toggleable) -->
    {{#if sectionAbbreviations}}
    <h2>Definitions & Abbreviations</h2>
    {{{abbreviations}}}
    {{/if}}

    <!-- Precautions -->
    <h2>Precautions & Safety</h2>
    {{{precautions}}}

    <!-- Procedure -->
    <h2>Procedure</h2>
    {{{procedure}}}

    <!-- References (Toggleable) -->
    {{#if sectionReferences}}
    <h2>References</h2>
    {{{references}}}
    {{/if}}

    <!-- Annexures (Toggleable) -->
    {{#if sectionAnnexures}}
    <h2>Annexures</h2>
    {{{annexures}}}
    {{/if}}

    <!-- Change History (Toggleable) -->
    {{#if sectionChangeHistory}}
    <h2>Change History</h2>
    <table>
        <thead>
            <tr>
                <th>Revision No.</th>
                <th>Date</th>
                <th>Description of Changes</th>
                <th>Approved By</th>
            </tr>
        </thead>
        <tbody>
            {{{changeHistoryRows}}}
        </tbody>
    </table>
    {{/if}}

    <!-- Approval Signatures -->
    <h2 class="no-counter">Approval Signatures</h2>
    <table class="signature-table">
        <tr>
            <th>Prepared By</th>
            <th>Checked By</th>
            <th>Approved By</th>
        </tr>
        <tr>
            <td>
                <p><b>Name:</b> {{preparedBy}}</p>
                <p><b>Designation:</b> {{preparedDesig}}</p>
                <p><b>Date:</b> {{preparedDate}}</p>
                <p><b>Signature:</b> _______________</p>
            </td>
            <td>
                <p><b>Name:</b> {{checkedBy}}</p>
                <p><b>Designation:</b> {{checkedDesig}}</p>
                <p><b>Date:</b> {{checkedDate}}</p>
                <p><b>Signature:</b> _______________</p>
            </td>
            <td>
                <p><b>Name:</b> {{approvedBy}}</p>
                <p><b>Designation:</b> {{approvedDesig}}</p>
                <p><b>Date:</b> {{approvedDate}}</p>
                <p><b>Signature:</b> _______________</p>
            </td>
        </tr>
    </table>
</body>
</html>