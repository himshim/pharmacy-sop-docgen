/**
 * ═══════════════════════════════════════════════════════════════════
 * SOP PRINT STYLES - FINAL MOBILE & PRINT FIX
 * ═══════════════════════════════════════════════════════════════════
 */

/* ============ 1. PAGE SETUP ============ */
@page {
    size: A4 portrait;
    margin: 15mm; /* Slightly safer margin */
}

/* ============ 2. DESKTOP PREVIEW ============ */
#preview-wrapper {
    background: #525659;
    padding: 30px 0;
    overflow: auto;
    height: 100vh;
    display: block;
    text-align: center;
}

#preview {
    width: 210mm !important;
    min-height: 297mm !important;
    height: auto !important;
    margin: 0 auto;
    padding: 20mm !important;
    background: white !important;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    text-align: left;
    display: inline-block;
    position: relative;
    box-sizing: border-box;

    font-family: "Times New Roman", Times, serif !important;
    font-size: 12pt !important;
    line-height: 1.5 !important;
    color: #000 !important;
}

/* ============ 3. MOBILE PREVIEW FIX (The "Zoom Out" Logic) ============ */
@media screen and (max-width: 850px) {
    #preview-wrapper {
        padding: 10px 0 !important;
        overflow-x: hidden !important;
        width: 100vw !important;
        display: flex !important;
        justify-content: center !important;
        align-items: flex-start !important;
        background: #f0f0f5 !important; /* Lighter bg for mobile */
    }

    #preview {
        /* Force exact A4 dimensions */
        width: 210mm !important; 
        min-width: 210mm !important;
        max-width: 210mm !important;
        
        /* 
           SCALE LOGIC:
           A4 Width = 210mm ≈ 794px
           Mobile Screen ≈ 360px - 400px
           Scale Factor ≈ 0.45 
        */
        transform: scale(0.42) !important; 
        transform-origin: top center !important;
        
        /* Reset layout for scaled element */
        margin: 0 !important;
        margin-top: 10px !important;
        
        /* Fix the empty space below caused by scaling */
        margin-bottom: -50% !important; 
        box-shadow: 0 2px 8px rgba(0,0,0,0.15) !important;
    }
}

/* ============ 4. PRINT FIX (The "Blank Page" Killer) ============ */
@media print {
    /* RESET EVERYTHING */
    :root, html, body {
        width: 100% !important;
        height: auto !important;
        margin: 0 !important;
        padding: 0 !important;
        overflow: visible !important;
        background: white !important;
        display: block !important;
    }

    /* HIDE UI */
    .app-container, header, nav, footer, aside,
    .controls-panel, .status-bar, .toolbar-buttons,
    .mobile-header, .tab-navigation, .preview-toolbar,
    .page-break-indicator, .tab-panel:not(#tab-preview) {
        display: none !important;
    }

    /* UNWRAP CONTENT */
    #preview-wrapper, .mobile-content, .tab-panel, .content {
        position: static !important;
        display: block !important;
        overflow: visible !important;
        height: auto !important;
        width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
        background: transparent !important;
        transform: none !important;
        border: none !important;
    }

    /* FORCE PAGE VISIBILITY */
    #preview {
        /* Let the printer determine width */
        width: 100% !important;
        max-width: 100% !important;
        min-width: 0 !important;
        
        /* Reset positioning */
        margin: 0 !important;
        padding: 0 !important; /* Margins handled by @page */
        position: static !important;
        
        display: block !important;
        visibility: visible !important;
        overflow: visible !important;
        
        /* Disable effects */
        transform: none !important;
        box-shadow: none !important;
        border: none !important;
        float: none !important;
    }
    
    /* Ensure content inside prints */
    #preview * {
        visibility: visible !important;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
    }
    
    /* Page Breaks */
    .page-break-before { page-break-before: always !important; height: 1px; display: block; }
    h1, h2 { page-break-after: avoid !important; }
    table, tr, td { page-break-inside: avoid !important; }
}
